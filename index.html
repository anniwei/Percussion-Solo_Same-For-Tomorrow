<!DOCTYPE html>
<html>
<head>
    <style>
        /* 視覺設計：黑底綠字 */
        body { background-color: black; color: #33FF33; font-family: 'Courier New', Courier, monospace; display: flex; flex-direction: column; height: 100vh; margin: 0; padding: 20px; box-sizing: border-box; font-size: 24px; }
        #history { overflow-y: auto; flex-grow: 1; white-space: pre-wrap; }
        #input-line { display: flex; }
        #cursor { width: 10px; background-color: #33FF33; animation: blink 1s infinite; }
        @keyframes blink { 50% { opacity: 0; } }
        input { background: transparent; border: none; color: #33FF33; font-family: inherit; font-size: inherit; outline: none; flex-grow: 1; }
    </style>
</head>
<body>
    <div id="history">Welcome to System v1.0.8... Type "help" for commands.</div>
    <div id="input-line">
        <span>[User@Mind] $ &nbsp;</span>
        <input type="text" id="terminal-input" autofocus>
        <div id="cursor"></div>
    </div>

    <script>
        let hasStarted = false;
        let isWritingMode = false;
        let chapter = 1; // 預設是第一樂章
        const input = document.getElementById('terminal-input');
        const history = document.getElementById('history');

        const lines = [
            "Good morning, Chi-En",
            "Welcome to System v1.0.8...",
            "Initialize tasks for today?",
            'Type "help" for commands.'
        ];

        function scrollToBottom() {
            history.scrollTop = history.scrollHeight;
            window.scrollTo(0, document.body.scrollHeight);
        }

        function showLine(index) {
            if (index < lines.length) {
                history.innerHTML += `<div>${lines[index]}</div>`;
                setTimeout(() => {
                    showLine(index + 1);
                }, 2500); 
                scrollToBottom();
            }
        }

        window.onload = () => {
            history.innerHTML = "<div>[System Standby] Press Enter to initialize...</div>";
        }

        input.addEventListener('keydown', function(e) {
            if (e.key === 'Enter') {
                const cmd = input.value.trim();
                const lowerCmd = cmd.toLowerCase().replace(/\?/g, "");

                // ** 階段 0：初始化啟動 **
                if (!hasStarted) {
                    history.innerHTML = ""; 
                    showLine(0);
                    hasStarted = true;
                    input.value = "";
                    return;
                }

                // ** 階段 1：寫信模式 **
                if (isWritingMode) {
                    if (lowerCmd === "send") {
                        history.innerHTML += `<div style="color: yellow; margin-top: 10px;">Sending email...</div>`;
                        setTimeout(() => {
                            history.innerHTML += `<div style="color: yellow;">Email sent.</div>`;
                            setTimeout(() => {
                                isWritingMode = false; 
                                history.innerHTML += `<div style="color: #33FF33; margin-top: 5px;">-- Writing mode ended. System restored. --</div>`;
                                chapter = 2; // 自動切換到第二樂章預備狀態
                                scrollToBottom();
                            }, 800);
                        }, 1000);
                    } else {
                        history.innerHTML += `<div style="font-style: italic; padding-left: 10px;">${cmd}</div>`;
                        scrollToBottom();
                    }

                    input.value = ""; // 清空輸入框
                    return; // 重要！加上這一行，就不會跑出後面的 Data logged 了
                } 

                // --- 第二樂章的特殊觸發 ---
                // 假設你在演出中手動切換了 chapter = 2 (或輸入特定指令切換)
                if (chapter === 2 && cmd === "") {
                    history.innerHTML += `<div style="margin-top: 15px;">System:</div>`;
                    setTimeout(() => {
                        history.innerHTML += `<div>Welcome back.</div>`;
                        scrollToBottom();
                        setTimeout(() => {
                            history.innerHTML += `<div>It is now 2:30 PM.</div>`;
                            scrollToBottom();
                            setTimeout(() => {
                                history.innerHTML += `<div>You have 67% of the day remaining.</div>`;
                                scrollToBottom();
                            }, 1200);
                        }, 1200);
                    }, 500);
                    input.value = "";
                    return; // 執行完就結束，不跑後面的指令
                }

                // ** 階段 2：一般模式 (特殊指令優先) **
                else {
                    const lowerCmd = cmd.toLowerCase().replace(/\?/g, "");

                    // 1. how was it & really
                    if (lowerCmd === "how was it" || lowerCmd === "really") {
                        history.innerHTML += `<div>[User@Mind] $ ${cmd}</div>`;
                        scrollToBottom();

                        setTimeout(() => {
                            const loadingRow = document.createElement('div');
                            // 這裡加個小細節：如果是 really，字樣會稍微不同
                            const statusText = (lowerCmd === "really") ? "Re-evaluating" : "Evaluating";
                            loadingRow.innerHTML = `System: ${statusText} perfection... `;
                            history.appendChild(loadingRow);
                            scrollToBottom();

                            setTimeout(() => {
                                const randomPercent = Math.floor(Math.random() * 26) + 60;
                                const percentSpan = document.createElement('span');
                                percentSpan.style.color = "white";
                                percentSpan.innerText = `${randomPercent}%`;
                                
                                loadingRow.appendChild(percentSpan);
                                scrollToBottom(); 
                            }, 600);
                        }, 500);
                    } 

                    // 2. Just arrived
                    else if (lowerCmd === "just arrived practice room") {
                        history.innerHTML += `<div>[User@Mind] $ ${cmd}</div>`;
                        scrollToBottom();
                        setTimeout(() => {
                            history.innerHTML += `<div>Logged in at 8:04 AM</div>`;
                            scrollToBottom();
                            setTimeout(() => {
                                history.innerHTML += `<div>Today’s outlook: 14 hours of potential productivity</div>`;
                                scrollToBottom();
                                setTimeout(() => {
                                    history.innerHTML += `<div style="color: #33FF33; font-weight: bold;">Ready to practice?</div>`;
                                    scrollToBottom();
                                }, 1200);
                            }, 1200);
                        }, 1000);
                    }

                    // 3. start practice (yes)
                    else if (lowerCmd === "yes") {
                        history.innerHTML += `<div>[User@Mind] $ ${cmd}</div>`;
                        scrollToBottom();
                        setTimeout(() => {
                            history.innerHTML += `<div>Please set the metronome to 88</div>`;
                            scrollToBottom();
                            setTimeout(() => {
                                history.innerHTML += `<div>Have a good practice time</div>`;
                                scrollToBottom();
                            }, 1200);
                        }, 1200);
                    }

                    // 4. Good enough for the lesson this week (注意：因為拔掉了問號，這裡比對不加問號)
                    else if (lowerCmd === "good enough for the lesson this week") {
                        history.innerHTML += `<div>[User@Mind] $ ${cmd}</div>`;
                        setTimeout(() => {
                            history.innerHTML += `<div style="color: #FF3333; font-weight: bold;">[System Warning]: Insuf cient for target goals.</div>`;
                            scrollToBottom();
                        }, 3000);
                    }

                    // 5. Write an email
                    else if (lowerCmd === "write an email") {
                        isWritingMode = true;
                        history.innerHTML += `<div style="color: yellow; margin-top: 10px;">-- Entering writing mode. (Type "send" to finish) --</div>`;
                    }

                    // 6. Help
                    else if (lowerCmd === "help") {
                        history.innerHTML += `<div>Available: [just arrived practice room, how was it, am i doing enough, write an email, help]</div>`;
                    }

                    // 7. lost track of time
                    else if (lowerCmd === "lost track of time") {
                        history.innerHTML += `<div>[User@Mind] $ ${cmd}</div>`;
                        scrollToBottom();
                        setTimeout(() => {
                            history.innerHTML += `<div>Idle period detected: 15 minutes.</div>`;
                            scrollToBottom();
                            setTimeout(() => {
                                history.innerHTML += `<div>Resuming task list...</div>`;
                                scrollToBottom();
                            }, 2000);
                        }, 2000);
                    }

                    // 7. 最後保底：Data Logged
                    else if (cmd !== "") {
                        history.innerHTML += `<div>[User@Mind] $ ${cmd}</div>`;
                        scrollToBottom();
                        setTimeout(() => {
                            history.innerHTML += `<div>System: Data logged.</div>`;
                            scrollToBottom();
                        }, 1000);
                    }
                }

                input.value = "";
                scrollToBottom();
            }
        });
    </script>
</body>
</html>